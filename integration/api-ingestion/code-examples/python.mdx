---
title: "Python - Exemplo de Integração"
description: "Code example copy-paste ready em Python para integração com a API de Ingestão Nexfar"
---

# Python - Exemplo de Integração

Este guia apresenta um exemplo completo e pronto para uso de como integrar sua aplicação Python com a API de Ingestão Nexfar.

## Requisitos

- **Python 3.8+**
- **Biblioteca `requests`** - Cliente HTTP popular e fácil de usar

## Instalação

Instale a biblioteca `requests` usando pip:

```bash
pip install requests
```

## Código Completo

O exemplo abaixo demonstra como autenticar e enviar dados de um cliente para a API Nexfar:

```python
import requests

# Configuração da API
API_URL = "https://api-sandbox.nexfar.com.br"
JWT_TOKEN = "seu_token_jwt_aqui"  # TODO: Substituir pelo token fornecido pela Nexfar

# Headers de autenticação
headers = {
    "Authorization": f"Bearer {JWT_TOKEN}",
    "Content-Type": "application/json"
}

# Payload com dados do cliente
# IMPORTANTE: Substitua os dados de exemplo pelos dados reais do seu cliente
client_data = {
    "cnpj": "12.345.678/0001-90",  # CNPJ no formato com pontuação
    "razao_social": "Farmácia Exemplo LTDA",
    "email": "contato@exemplo.com.br",
    "status": "ACTIVE"
}

# Função para enviar dados do cliente
def send_client():
    try:
        # Enviar requisição POST para criar cliente
        response = requests.post(
            f"{API_URL}/api/v1/clients",
            json=client_data,
            headers=headers,
            timeout=10  # Timeout de 10 segundos
        )

        # Lançar exceção se status code for 4xx ou 5xx
        response.raise_for_status()

        # Sucesso - Cliente criado com status 201
        data = response.json()
        print(f"✓ Cliente criado com sucesso!")
        print(f"  ID: {data['id']}")
        print(f"  Correlation ID: {data['correlation_id']}")
        return data

    except requests.exceptions.HTTPError as e:
        # Tratar erros HTTP (400 Bad Request, 401 Unauthorized, etc)
        status_code = e.response.status_code

        if status_code == 400:
            # Erro de validação - payload inválido
            error_detail = e.response.json()
            print(f"✗ Erro de validação (400 Bad Request):")
            print(f"  {error_detail}")
            print("\n  Verifique se todos os campos obrigatórios estão presentes")
            print("  e se o formato do CNPJ está correto.")

        elif status_code == 401:
            # Erro de autenticação - token inválido ou expirado
            print(f"✗ Erro de autenticação (401 Unauthorized):")
            print(f"  Token JWT inválido ou expirado.")
            print("\n  Verifique se o token está correto e ainda é válido.")

        else:
            # Outros erros HTTP
            print(f"✗ Erro HTTP {status_code}:")
            print(f"  {e.response.text}")

    except requests.exceptions.Timeout:
        # Timeout - servidor não respondeu a tempo
        print(f"✗ Erro de timeout:")
        print(f"  O servidor não respondeu em 10 segundos.")
        print("\n  Tente novamente mais tarde ou verifique sua conexão.")

    except requests.exceptions.ConnectionError:
        # Erro de conexão - não foi possível conectar ao servidor
        print(f"✗ Erro de conexão:")
        print(f"  Não foi possível conectar ao servidor {API_URL}")
        print("\n  Verifique sua conexão com a internet e se a URL está correta.")

    except requests.exceptions.RequestException as e:
        # Outros erros de requisição
        print(f"✗ Erro de requisição: {e}")

# Executar função
if __name__ == "__main__":
    send_client()
```

## Como Executar

Após substituir o token JWT e os dados do cliente, execute o script:

```bash
python send_client.py
```

**Resposta esperada em caso de sucesso:**

```
✓ Cliente criado com sucesso!
  ID: 550e8400-e29b-41d4-a716-446655440000
  Correlation ID: 7c9e6679-7425-40de-944b-e07fc1f90ae7
```

## Explicação do Código

### 1. Configuração Inicial

```python
API_URL = "https://api-sandbox.nexfar.com.br"
JWT_TOKEN = "seu_token_jwt_aqui"
```

- **API_URL**: Endereço do ambiente sandbox. Para produção, use `https://api.nexfar.com.br`
- **JWT_TOKEN**: Token de autenticação fornecido pela Nexfar. Deve ser substituído pelo token real.

### 2. Headers de Autenticação

```python
headers = {
    "Authorization": f"Bearer {JWT_TOKEN}",
    "Content-Type": "application/json"
}
```

- **Authorization**: Header obrigatório com o token JWT no formato Bearer
- **Content-Type**: Indica que o payload está em formato JSON

### 3. Payload do Cliente

```python
client_data = {
    "cnpj": "12.345.678/0001-90",
    "razao_social": "Farmácia Exemplo LTDA",
    "email": "contato@exemplo.com.br",
    "status": "ACTIVE"
}
```

Os campos obrigatórios para criar um cliente são:
- **cnpj**: CNPJ no formato XX.XXX.XXX/XXXX-XX
- **razao_social**: Razão social da empresa
- **email**: E-mail de contato
- **status**: Status do cliente (ACTIVE ou INACTIVE)

### 4. Tratamento de Erros

O código trata três tipos principais de erros:

1. **HTTPError (400/401)**: Erros de validação ou autenticação
2. **Timeout**: Servidor não respondeu a tempo
3. **ConnectionError**: Problemas de conectividade

Para cada tipo de erro, uma mensagem clara é exibida com orientações de como resolver.

## Troubleshooting Comum

<AccordionGroup>
  <Accordion title="401 Unauthorized - Token Inválido">
    **Problema:** A API retorna erro 401 Unauthorized.

    **Causas Comuns:**
    - Token JWT expirado
    - Token JWT inválido ou malformado
    - Token não tem permissões necessárias

    **Solução:**
    1. Verifique se o token está correto (sem espaços extras)
    2. Confirme que o token ainda é válido (não expirou)
    3. Entre em contato com o suporte Nexfar para renovar o token se necessário
  </Accordion>

  <Accordion title="400 Bad Request - Erro de Validação">
    **Problema:** A API retorna erro 400 Bad Request.

    **Causas Comuns:**
    - CNPJ em formato inválido
    - Campos obrigatórios faltando
    - Tipos de dados incorretos

    **Solução:**
    1. Verifique se o CNPJ está no formato correto: XX.XXX.XXX/XXXX-XX
    2. Confirme que todos os campos obrigatórios estão presentes
    3. Revise a resposta de erro para detalhes específicos sobre qual campo está inválido
  </Accordion>

  <Accordion title="Connection Refused - Erro de Conexão">
    **Problema:** Não é possível conectar ao servidor.

    **Causas Comuns:**
    - URL incorreta (sandbox vs produção)
    - Problema de conectividade de rede
    - Firewall bloqueando a conexão

    **Solução:**
    1. Verifique se a URL está correta:
       - Sandbox: `https://api-sandbox.nexfar.com.br`
       - Produção: `https://api.nexfar.com.br`
    2. Teste sua conexão com a internet
    3. Verifique configurações de firewall/proxy
  </Accordion>

  <Accordion title="SSL Certificate Problem">
    **Problema:** Erro de certificado SSL.

    **Solução:**
    Se você estiver em um ambiente corporativo com proxy SSL, pode ser necessário configurar certificados:

    ```python
    # Opção 1: Desabilitar verificação SSL (NÃO recomendado para produção)
    response = requests.post(url, json=data, headers=headers, verify=False)

    # Opção 2: Especificar bundle de certificados
    response = requests.post(url, json=data, headers=headers, verify='/path/to/certfile')
    ```

    **Atenção:** Desabilitar verificação SSL não é recomendado para ambientes de produção.
  </Accordion>
</AccordionGroup>

## Próximos Passos

<CardGroup cols={2}>
  <Card title="Quick Start Guide" icon="rocket" href="/integration/api-ingestion/quickstart">
    Entenda o fluxo completo de integração em 10 minutos
  </Card>

  <Card title="Autenticação JWT" icon="key" href="/integration/api-ingestion/authentication">
    Aprenda como obter e gerenciar tokens JWT
  </Card>

  <Card title="API Reference" icon="book" href="/api-reference">
    Explore todos os endpoints disponíveis e seus parâmetros
  </Card>

  <Card title="Troubleshooting" icon="wrench" href="/integration/api-ingestion/troubleshooting">
    Resolva problemas comuns de integração
  </Card>
</CardGroup>

---

<Note>
  **Dúvidas?** Entre em contato com o suporte técnico Nexfar através do e-mail: suporte@nexfar.com.br
</Note>
