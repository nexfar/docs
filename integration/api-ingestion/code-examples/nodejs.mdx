---
title: "Node.js - Exemplo de Integração"
description: "Code example copy-paste ready em Node.js para integração com a API de Ingestão Nexfar"
---

# Node.js - Exemplo de Integração

Este guia apresenta um exemplo completo e pronto para uso de como integrar sua aplicação Node.js com a API de Ingestão Nexfar.

## Requisitos

- **Node.js 14+** (recomendado Node.js 18+ LTS)
- **Biblioteca `axios`** - Cliente HTTP popular com excelente suporte a Promises e error handling

## Instalação

Instale a biblioteca `axios` usando npm ou yarn:

```bash
# Usando npm
npm install axios

# Usando yarn
yarn add axios
```

## Código Completo

O exemplo abaixo demonstra como autenticar e enviar dados de um cliente para a API Nexfar:

```javascript
const axios = require('axios');

// Configuração da API
const API_URL = "https://api.nexfar.com.br";
const JWT_TOKEN = "seu_token_jwt_aqui"; // TODO: Substituir pelo token fornecido pela Nexfar

// Payload com dados do cliente
// IMPORTANTE: Substitua os dados de exemplo pelos dados reais do seu cliente
const clientData = {
    name: "Farmácia Exemplo",
    cnpj: "12345678000190",
    externalId: "CLI-EX-001",
    razaoSocial: "Farmácia Exemplo LTDA",
    state: "SP",
    emailErp: "contato@exemplo.com.br",
    phone: "11987654321",
    drugstore: true
};

/**
 * Função para enviar dados do cliente para a API Nexfar
 */
async function sendClient() {
    try {
        // Enviar requisição POST para criar cliente
        const response = await axios.post(
            `${API_URL}/api/v1/clients`,
            clientData,
            {
                headers: {
                    'Authorization': `Bearer ${JWT_TOKEN}`,  // Autenticação JWT
                    'Content-Type': 'application/json'       // Tipo de conteúdo JSON
                },
                timeout: 10000  // Timeout de 10 segundos
            }
        );

        // Sucesso - Cliente criado com status 201
        console.log('✓ Cliente criado com sucesso!');
        console.log(`  ID: ${response.data.id}`);
        console.log(`  Correlation ID: ${response.data.correlation_id}`);

        return response.data;

    } catch (error) {
        // Tratamento de erros
        if (error.response) {
            // Erro HTTP - servidor respondeu com status code 4xx ou 5xx
            const statusCode = error.response.status;
            const errorData = error.response.data;

            if (statusCode === 400) {
                // Erro de validação - payload inválido
                console.error('✗ Erro de validação (400 Bad Request):');
                console.error('  Detalhes:', errorData);
                console.error('\n  Verifique se todos os campos obrigatórios estão presentes');
                console.error('  e se o formato do CNPJ está correto.');

            } else if (statusCode === 401) {
                // Erro de autenticação - token inválido ou expirado
                console.error('✗ Erro de autenticação (401 Unauthorized):');
                console.error('  Token JWT inválido ou expirado.');
                console.error('\n  Verifique se o token está correto e ainda é válido.');

            } else if (statusCode >= 500) {
                // Erro do servidor
                console.error(`✗ Erro do servidor (${statusCode}):`);
                console.error('  O servidor está enfrentando problemas.');
                console.error('  Tente novamente mais tarde.');

            } else {
                // Outros erros HTTP
                console.error(`✗ Erro HTTP ${statusCode}:`);
                console.error('  Detalhes:', errorData);
            }

        } else if (error.request) {
            // Erro de rede - requisição foi feita mas sem resposta
            console.error('✗ Erro de rede:');
            console.error('  Não foi possível conectar ao servidor.');
            console.error(`  URL: ${API_URL}`);
            console.error('\n  Verifique sua conexão com a internet');
            console.error('  e se a URL está correta.');

        } else {
            // Erro na configuração da requisição
            console.error('✗ Erro na configuração da requisição:');
            console.error('  ', error.message);
        }

        // Re-lançar erro para tratamento adicional se necessário
        throw error;
    }
}

// Executar função
sendClient()
    .then(data => {
        console.log('\n✓ Processo concluído com sucesso!');
    })
    .catch(error => {
        console.error('\n✗ Processo falhou.');
        process.exit(1);  // Encerrar com código de erro
    });
```

## Como Executar

Após instalar as dependências e substituir o token JWT e os dados do cliente, execute o script:

```bash
node sendClient.js
```

**Resposta esperada em caso de sucesso:**

```
✓ Cliente criado com sucesso!
  ID: 550e8400-e29b-41d4-a716-446655440000
  Correlation ID: 7c9e6679-7425-40de-944b-e07fc1f90ae7

✓ Processo concluído com sucesso!
```

## Explicação do Código

### 1. Configuração Inicial

```javascript
const API_URL = "https://api.nexfar.com.br";
const JWT_TOKEN = "seu_token_jwt_aqui";
```

- **API_URL**: Endereço do ambiente sandbox. Para produção, use `https://api.nexfar.com.br`
- **JWT_TOKEN**: Token de autenticação fornecido pela Nexfar. Deve ser substituído pelo token real.

### 2. Payload do Cliente

```javascript
const clientData = {
    name: "Farmácia Exemplo",
    cnpj: "12345678000190",
    externalId: "CLI-EX-001",
    razaoSocial: "Farmácia Exemplo LTDA",
    state: "SP",
    emailErp: "contato@exemplo.com.br",
    phone: "11987654321",
    drugstore: true
};
```

Os campos obrigatórios para criar um cliente são:
- **name**: Nome fantasia da farmácia
- **cnpj**: CNPJ (apenas números, 14 dígitos)
- **externalId**: ID do cliente no ERP
- **razaoSocial**: Razão social da empresa
- **state**: UF do estado (2 caracteres, ex: "SP")

Campos opcionais comuns:
- **emailErp**: E-mail de contato
- **phone**: Telefone (apenas números)
- **drugstore**: Indica se é farmácia (true/false)
- **customFields**: Campos personalizados (object)
- **extraParams**: Parâmetros extras (object)

### 3. Função Async/Await

```javascript
async function sendClient() {
    try {
        const response = await axios.post(url, data, config);
        // Processar resposta
    } catch (error) {
        // Tratar erro
    }
}
```

A função usa **async/await** para lidar com Promises de forma mais clara e legível. O bloco **try-catch** captura qualquer erro que ocorra durante a requisição.

### 4. Tratamento de Erros em 3 Níveis

O axios categoriza erros em três tipos:

1. **error.response**: Servidor respondeu com erro (4xx, 5xx)
2. **error.request**: Requisição foi enviada mas não houve resposta
3. **Outros erros**: Problemas na configuração da requisição

Cada tipo é tratado de forma específica para fornecer mensagens claras ao usuário.

## Usando com TypeScript (Opcional)

Se você está usando TypeScript, aqui está a versão tipada do código:

```typescript
import axios, { AxiosError } from 'axios';

// Interfaces
interface ClientData {
    name: string;
    cnpj: string;
    externalId: string;
    razaoSocial: string;
    state: string;
    emailErp?: string;
    phone?: string;
    drugstore?: boolean;
    customFields?: Record<string, any>;
    extraParams?: Record<string, any>;
}

interface ClientResponse {
    id: string;
    correlation_id: string;
    name: string;
    cnpj: string;
    externalId: string;
    razaoSocial: string;
    state: string;
    emailErp?: string;
    created_at: string;
}

interface ErrorResponse {
    statusCode: number;
    message: string | string[];
    error: string;
}

// Configuração
const API_URL = "https://api.nexfar.com.br";
const JWT_TOKEN = "seu_token_jwt_aqui";

const clientData: ClientData = {
    name: "Farmácia Exemplo",
    cnpj: "12345678000190",
    externalId: "CLI-EX-001",
    razaoSocial: "Farmácia Exemplo LTDA",
    state: "SP",
    emailErp: "contato@exemplo.com.br",
    phone: "11987654321",
    drugstore: true
};

async function sendClient(): Promise<ClientResponse> {
    try {
        const response = await axios.post<ClientResponse>(
            `${API_URL}/api/v1/clients`,
            clientData,
            {
                headers: {
                    'Authorization': `Bearer ${JWT_TOKEN}`,
                    'Content-Type': 'application/json'
                },
                timeout: 10000
            }
        );

        console.log('✓ Cliente criado com sucesso!');
        console.log(`  ID: ${response.data.id}`);
        console.log(`  Correlation ID: ${response.data.correlation_id}`);

        return response.data;

    } catch (error) {
        const axiosError = error as AxiosError<ErrorResponse>;

        if (axiosError.response) {
            const { status, data } = axiosError.response;
            console.error(`✗ Erro HTTP ${status}:`, data);
        } else if (axiosError.request) {
            console.error('✗ Erro de rede: Sem resposta do servidor');
        } else {
            console.error('✗ Erro:', axiosError.message);
        }

        throw error;
    }
}

// Executar
sendClient();
```

## Alternativa: Usando node-fetch

Se você preferir usar `node-fetch` em vez de `axios`:

```bash
npm install node-fetch
```

```javascript
const fetch = require('node-fetch');

const API_URL = "https://api.nexfar.com.br";
const JWT_TOKEN = "seu_token_jwt_aqui";

async function sendClient() {
    try {
        const response = await fetch(`${API_URL}/api/v1/clients`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${JWT_TOKEN}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(clientData)
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(`HTTP ${response.status}: ${JSON.stringify(errorData)}`);
        }

        const data = await response.json();
        console.log('✓ Cliente criado:', data);
        return data;

    } catch (error) {
        console.error('✗ Erro:', error.message);
        throw error;
    }
}
```

## Troubleshooting Comum

<AccordionGroup>
  <Accordion title="401 Unauthorized - Token Inválido">
    **Problema:** A API retorna erro 401 Unauthorized.

    **Causas Comuns:**
    - Token JWT expirado
    - Token JWT inválido ou malformado
    - Token não tem permissões necessárias

    **Solução:**
    1. Verifique se o token está correto (sem espaços extras)
    2. Confirme que o token ainda é válido (não expirou)
    3. Entre em contato com o suporte Nexfar para renovar o token se necessário
  </Accordion>

  <Accordion title="400 Bad Request - Erro de Validação">
    **Problema:** A API retorna erro 400 Bad Request.

    **Causas Comuns:**
    - CNPJ em formato inválido
    - Campos obrigatórios faltando
    - Tipos de dados incorretos

    **Solução:**
    1. Verifique se o CNPJ está no formato correto: XX.XXX.XXX/XXXX-XX
    2. Confirme que todos os campos obrigatórios estão presentes
    3. Revise a resposta de erro para detalhes específicos sobre qual campo está inválido
  </Accordion>

  <Accordion title="ECONNREFUSED - Connection Refused">
    **Problema:** `Error: connect ECONNREFUSED`

    **Causas Comuns:**
    - URL incorreta (sandbox vs produção)
    - Problema de conectividade de rede
    - Firewall bloqueando a conexão

    **Solução:**
    1. Verifique se a URL está correta:
       - Sandbox: `https://api.nexfar.com.br`
       - Produção: `https://api.nexfar.com.br`
    2. Teste sua conexão com a internet
    3. Verifique configurações de firewall/proxy
  </Accordion>

  <Accordion title="ETIMEDOUT - Request Timeout">
    **Problema:** `Error: timeout of 10000ms exceeded`

    **Causas Comuns:**
    - Servidor lento ou sobrecarregado
    - Problema de conectividade
    - Timeout configurado muito baixo

    **Solução:**
    1. Aumente o timeout se necessário:
       ```javascript
       timeout: 30000  // 30 segundos
       ```
    2. Verifique a conectividade com o servidor
    3. Tente novamente mais tarde se o servidor estiver sobrecarregado
  </Accordion>

  <Accordion title="ERR_INVALID_CHAR - Erro de JSON">
    **Problema:** `SyntaxError: Unexpected token in JSON`

    **Causas Comuns:**
    - JSON malformado no payload
    - Caracteres especiais não escapados
    - Encoding incorreto

    **Solução:**
    1. Valide seu JSON usando `JSON.parse()` antes de enviar
    2. Use um validador JSON online
    3. Certifique-se de que strings com caracteres especiais estão sendo tratadas corretamente
  </Accordion>

  <Accordion title="SSL Certificate Problem">
    **Problema:** Erro de certificado SSL em ambientes corporativos

    **Solução:**
    Se você estiver em um ambiente corporativo com proxy SSL, pode ser necessário configurar:

    ```javascript
    const https = require('https');

    // Opção 1: Desabilitar verificação SSL (NÃO recomendado para produção)
    const agent = new https.Agent({
        rejectUnauthorized: false
    });

    axios.post(url, data, {
        httpsAgent: agent,
        // ... outras configurações
    });

    // Opção 2: Especificar certificado CA
    const agent = new https.Agent({
        ca: fs.readFileSync('path/to/ca-certificate.crt')
    });
    ```

    **Atenção:** Desabilitar verificação SSL não é recomendado para ambientes de produção.
  </Accordion>
</AccordionGroup>

## Próximos Passos

<CardGroup cols={2}>
  <Card title="Quick Start Guide" icon="rocket" href="/integration/api-ingestion/quickstart">
    Entenda o fluxo completo de integração em 10 minutos
  </Card>

  <Card title="Autenticação JWT" icon="key" href="/integration/api-ingestion/authentication">
    Aprenda como obter e gerenciar tokens JWT
  </Card>

  <Card title="API Reference" icon="book" href="/api-reference">
    Explore todos os endpoints disponíveis e seus parâmetros
  </Card>

  <Card title="Troubleshooting" icon="wrench" href="/integration/api-ingestion/troubleshooting">
    Resolva problemas comuns de integração
  </Card>
</CardGroup>

---

<Note>
  **Dúvidas?** Entre em contato com o suporte técnico Nexfar através do e-mail: suporte@nexfar.com.br
</Note>
