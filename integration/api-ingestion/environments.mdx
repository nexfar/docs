---
title: 'Ambientes: Sandbox vs Produ√ß√£o'
description: 'Entenda a diferen√ßa entre ambientes Sandbox e Produ√ß√£o da API de Ingest√£o Nexfar: isolamento de dados, pol√≠ticas de reten√ß√£o e fluxo recomendado de testes'
icon: 'flask'
---

## Por que Sandbox e Produ√ß√£o?

A API de Ingest√£o Nexfar oferece **dois ambientes completamente isolados** para garantir que voc√™ possa desenvolver e testar sua integra√ß√£o sem riscos antes de enviar dados reais.

<Note>
  **üìù Importante:** Todos os clientes DEVEM come√ßar no Sandbox. Credenciais de Produ√ß√£o s√≥ s√£o fornecidas ap√≥s valida√ß√£o completa no ambiente de testes.
</Note>

A filosofia √© simples: **teste sem riscos antes de enviar dados reais**. O Sandbox permite validar payloads, debugar erros e treinar sua equipe sem preocupa√ß√£o com corrup√ß√£o de dados ou impactos em produ√ß√£o.

## Compara√ß√£o de Ambientes

| Aspecto | Sandbox | Produ√ß√£o |
|---------|---------|----------|
| **URL Base** | `ingestion.nexfar.com.br` | `ingestion.nexfar.com.br` |
| **JWT Claim `environment`** | `"sandbox"` | `"production"` |
| **Finalidade** | Testes, desenvolvimento, integra√ß√£o | Dados reais, uso em produ√ß√£o |
| **Dados** | Isolados, fict√≠cios ou de teste | Dados reais da opera√ß√£o |
| **Reten√ß√£o de Dados** | Deletados automaticamente ap√≥s 30 dias | Persistentes, armazenados indefinidamente |
| **Solicita√ß√£o de Credenciais** | Fornecido automaticamente no onboarding | Ap√≥s valida√ß√£o completa no Sandbox |
| **Disponibilidade** | 99% (best-effort) | 99.5% (target SLA) |
| **Rate Limiting** | 100 req/min por cliente | 100 req/min por cliente (configur√°vel) |
| **Suporte** | Email, documenta√ß√£o | Email, documenta√ß√£o, SLA de resposta |

<Warning>
  **üîí Isolamento Absoluto:**
  - Dados enviados com token Sandbox NUNCA aparecem em Produ√ß√£o
  - Dados enviados com token Production NUNCA aparecem em Sandbox
  - Particionamento l√≥gico garante separa√ß√£o total
</Warning>

## Como Funciona o Isolamento

### Particionamento via JWT Claim

O isolamento entre Sandbox e Produ√ß√£o √© implementado atrav√©s de **particionamento l√≥gico**. Mesma infraestrutura, mesmo banco de dados, mas dados completamente separados por claim JWT.

```
JWT Token Sandbox ‚Üí Claim: environment="sandbox"
  ‚Üì
API valida e extrai claim
  ‚Üì
Dados salvos com tag environment="sandbox"
  ‚Üì
Queries filtram: WHERE tenant_id=X AND environment="sandbox"
  ‚Üì
Cliente v√™ APENAS dados Sandbox (isolamento absoluto)
```

### Como Verificar Seu Ambiente

Voc√™ pode verificar qual ambiente est√° usando decodificando seu JWT token:

1. Acesse [https://jwt.io](https://jwt.io)
2. Cole seu token JWT no campo "Encoded"
3. Veja o payload decodificado:

```json
{
  "tenant_id": "cli_abc123",
  "environment": "sandbox",  // ‚Üê "sandbox" ou "production"
  "scopes": ["ingestion:write"],
  "iat": 1707321600,
  "exp": 1738857600
}
```

<Warning>
  **üîí Isolamento Absoluto:**
  Dados enviados com token Sandbox NUNCA aparecem em Produ√ß√£o e vice-versa. Particionamento l√≥gico garante separa√ß√£o total mesmo usando a mesma infraestrutura.
</Warning>

## Pol√≠tica de Reten√ß√£o de Dados no Sandbox

Dados no Sandbox s√£o **tempor√°rios** e deletados automaticamente ap√≥s **30 dias** a partir da data de cria√ß√£o.

### Processo de Limpeza Autom√°tica

- **Worker autom√°tico** executa diariamente √†s 2:00 AM UTC
- Identifica registros com `created_at > 30 dias` E `environment = "sandbox"`
- Deleta automaticamente (dados n√£o s√£o recuper√°veis)

<Warning>
  **‚ö†Ô∏è IMPORTANTE:**
  - Dados no Sandbox s√£o deletados automaticamente ap√≥s 30 dias
  - N√£o use Sandbox para armazenamento de dados reais ou de longo prazo
  - Dados deletados n√£o s√£o recuper√°veis
</Warning>

<Tip>
  **üí° Use Sandbox para:**
  - Validar integra√ß√£o e testar payloads
  - Debugar erros e testar edge cases
  - Treinar equipe interna antes de ir para produ√ß√£o
  - Testar atualiza√ß√µes de API (novas vers√µes)
</Tip>

### Ciclo de Vida dos Dados

| Data | A√ß√£o | Status |
|------|------|--------|
| Dia 0 | Dado criado no Sandbox | ‚úÖ Dispon√≠vel |
| Dia 1-29 | Dado consult√°vel via API | ‚úÖ Dispon√≠vel |
| Dia 30 | Cleanup autom√°tico executa | ‚ùå Deletado permanentemente |

<Note>
  **üìù Pol√≠tica de Reten√ß√£o:**
  Ap√≥s valida√ß√£o completa, solicite credenciais de Produ√ß√£o para dados persistentes que n√£o expiram.
</Note>

## Fluxo Recomendado de Integra√ß√£o

<Steps>
  <Step title="Come√ßar no Sandbox">
    Receba credenciais JWT Sandbox via email da Nexfar. Configure sua aplica√ß√£o para apontar para `ingestion.nexfar.com.br`.

    **O que voc√™ receber√°:**
    - Token JWT com claim `environment: "sandbox"`
    - URL do Sandbox: `https://ingestion.nexfar.com.br`
    - Link para documenta√ß√£o da API
    - Client ID √∫nico

    <Tip>
      **üí° Sempre comece no Sandbox** - √© imposs√≠vel pular diretamente para Produ√ß√£o.
    </Tip>
  </Step>

  <Step title="Implementar Integra√ß√£o">
    Use o [Quick Start Guide](/integration/api-ingestion/quickstart) para enviar sua primeira requisi√ß√£o.

    - Envie dados de teste (fict√≠cios, anonimizados)
    - Valide que dados s√£o recebidos corretamente
    - Teste todos os modelos relevantes (clientes, produtos, pedidos)

    <Tip>
      **üí° Dica:** Use CNPJs fict√≠cios (formato v√°lido mas inexistente: `00.000.000/0000-00`) e emails de teste (`teste@exemplo.com.br`) para evitar dados reais no Sandbox.
    </Tip>
  </Step>

  <Step title="Validar Respostas">
    Confirme que integra√ß√£o est√° funcionando perfeitamente:

    - ‚úÖ C√≥digos 201 Created para envios bem-sucedidos
    - ‚úÖ Mensagens de erro claras para payloads inv√°lidos
    - ‚úÖ Audit Log API mostra hist√≥rico correto
    - ‚úÖ Taxa de sucesso > 95% para dados v√°lidos

    Consulte [Troubleshooting Guide](/integration/api-ingestion/troubleshooting) se encontrar erros.
  </Step>

  <Step title="Testar Casos de Erro">
    Valide que sua aplica√ß√£o trata erros corretamente:

    - Envie payloads inv√°lidos intencionalmente (CNPJ incorreto, campo obrigat√≥rio faltando)
    - Confirme que mensagens de erro s√£o capturadas
    - Teste rate limiting (> 100 req/min)
    - Simule timeout (payload muito grande)
  </Step>

  <Step title="Valida√ß√£o Completa">
    Envie volume representativo de dados de teste:

    - **Exemplo:** 100 clientes, 500 produtos, 50 pedidos
    - Confirme taxa de sucesso de 100% para dados v√°lidos
    - Garanta que integra√ß√£o est√° est√°vel por 24-48 horas
    - Documente configura√ß√£o final (URL, headers, payloads)
  </Step>

  <Step title="Solicitar Credenciais de Produ√ß√£o">
    Ap√≥s valida√ß√£o completa, solicite credenciais Production:

    - Envie email para: **suporte@nexfar.com.br**
    - Inclua: Client ID, resumo de valida√ß√£o, data estimada de go-live
    - Aguarde confirma√ß√£o (SLA: 24 horas)

    Veja template de email na se√ß√£o [Como Solicitar Credenciais de Produ√ß√£o](#solicitar-credenciais-de-producao).
  </Step>

  <Step title="Migrar para Produ√ß√£o">
    Ap√≥s receber JWT Production:

    - Atualize aplica√ß√£o: trocar URL (`ingestion.nexfar.com.br`) e JWT token
    - Envie primeiros dados reais
    - Monitore via [Audit Log API](/integration/api-ingestion/audit-log)
    - Confirme isolamento: dados Sandbox n√£o aparecem em Production

    <Warning>
      **‚ö†Ô∏è IMPORTANTE:** Ap√≥s migra√ß√£o para Production, continue usando Sandbox para testar novas features ou atualiza√ß√µes.
    </Warning>
  </Step>
</Steps>

<Note>
  **üìù Tempo Estimado:**
  - Desenvolvimento e testes no Sandbox: 1-3 dias
  - Valida√ß√£o completa: 1-2 dias
  - Aprova√ß√£o de credenciais Production: at√© 24 horas
  - **Total:** 3-6 dias (dependendo da complexidade da integra√ß√£o)
</Note>

## Quando Usar Cada Ambiente

### Use Sandbox Para:

- ‚úÖ Desenvolvimento e testes de integra√ß√£o
- ‚úÖ Validar payloads e estrutura de dados
- ‚úÖ Debugar erros e testar edge cases
- ‚úÖ Treinar equipe interna antes de ir para produ√ß√£o
- ‚úÖ Testar atualiza√ß√µes de API (novas vers√µes)
- ‚úÖ Simular cen√°rios de erro (rate limiting, timeout)

### Use Produ√ß√£o Para:

- ‚úÖ Enviar dados reais da opera√ß√£o
- ‚úÖ Integra√ß√£o cont√≠nua ap√≥s go-live
- ‚úÖ Sincroniza√ß√£o autom√°tica de ERP/Sistema interno
- ‚úÖ Dados que precisam ser persistidos indefinidamente

<Warning>
  **‚ùå Regras Importantes:**
  - **NUNCA use Produ√ß√£o para testes** - dados reais podem ser corrompidos
  - **NUNCA use Sandbox para dados sens√≠veis ou confidenciais** - dados s√£o deletados ap√≥s 30 dias
  - **NUNCA use dados reais no Sandbox** - use dados fict√≠cios ou anonimizados
</Warning>

## Como Solicitar Credenciais de Produ√ß√£o

### Pr√©-requisitos

Antes de solicitar credenciais de Produ√ß√£o, confirme que:

- ‚úÖ Valida√ß√£o completa no Sandbox (taxa de sucesso > 95%)
- ‚úÖ Testes de todos os modelos relevantes realizados
- ‚úÖ Integra√ß√£o est√°vel (sem erros cr√≠ticos)
- ‚úÖ Equipe interna treinada e familiarizada com API

### Processo de Solicita√ß√£o

1. Enviar email para: **suporte@nexfar.com.br**
2. Assunto: "Solicita√ß√£o de Credenciais de Produ√ß√£o - [Nome da Empresa]"
3. Informa√ß√µes necess√°rias no corpo do email:
   - Client ID do Sandbox (dispon√≠vel no JWT token)
   - Nome da empresa/distribuidor
   - Contato t√©cnico respons√°vel (nome, email, telefone)
   - Resumo de valida√ß√£o: modelos testados, volume de dados enviado
   - Data estimada de go-live em produ√ß√£o
4. Aguardar confirma√ß√£o da equipe Nexfar (SLA: 24 horas)
5. Receber novo JWT token com claim `environment = "production"`

<Note>
  **üìù Tokens de Produ√ß√£o:**
  - Validade configur√°vel (tipicamente 365 dias)
  - Renova√ß√£o deve ser solicitada 30 dias antes da expira√ß√£o
</Note>

### Template de Email

```
Para: suporte@nexfar.com.br
Assunto: Solicita√ß√£o de Credenciais de Produ√ß√£o - Farm√°cia XYZ

Ol√°,

Finalizamos a valida√ß√£o da integra√ß√£o com a API de Ingest√£o Nexfar no ambiente Sandbox e gostar√≠amos de solicitar credenciais de Produ√ß√£o.

**Informa√ß√µes:**
- Client ID (Sandbox): cli_abc123xyz789
- Empresa: Farm√°cia XYZ Distribuidora LTDA
- CNPJ: 12.345.678/0001-90
- Contato T√©cnico: Jo√£o Silva (joao.silva@farmaciaxyz.com.br / +55 11 98765-4321)

**Resumo de Valida√ß√£o:**
- Modelos testados: clients, products, orders, invoices
- Volume enviado: 150 clientes, 800 produtos, 50 pedidos
- Taxa de sucesso: 100%
- Per√≠odo de testes: 15/11/2025 - 20/11/2025

**Data estimada de go-live:** 25/11/2025

Atenciosamente,
Jo√£o Silva
Desenvolvedor - Farm√°cia XYZ
```

## Boas Pr√°ticas de Uso de Ambientes

### 1. Nunca use dados reais no Sandbox

Use dados fict√≠cios ou anonimizados:
- CNPJs de teste: `00.000.000/0000-00` (formato v√°lido mas fict√≠cio)
- Emails de teste: `teste@exemplo.com.br`
- Nomes: "Cliente Teste", "Produto Exemplo"

### 2. Mantenha tokens separados

Configure vari√°veis de ambiente distintas:
- Sandbox token: `NEXFAR_JWT_SANDBOX`
- Production token: `NEXFAR_JWT_PRODUCTION`
- **NUNCA misture tokens entre ambientes**

### 3. Configure URLs dinamicamente

Use vari√°veis de ambiente para URL base:

```python
import os

ENV = os.getenv("NEXFAR_ENV", "sandbox")  # Default: sandbox
API_URL = (
    "https://ingestion.nexfar.com.br"
    if ENV == "sandbox"
    else "https://ingestion.nexfar.com.br"
)
JWT_TOKEN = os.getenv(f"NEXFAR_JWT_{ENV.upper()}")
```

### 4. Monitore expira√ß√£o de dados no Sandbox

- Dados > 30 dias s√£o deletados automaticamente
- Se precisar retestar, reenvie dados
- Considere script de carga de dados de teste

### 5. Valide isolamento ap√≥s migra√ß√£o

- Ap√≥s receber token Production, confirme que n√£o v√™ dados Sandbox
- Use Audit Log API para validar environment correto

### 6. Documente configura√ß√£o de ambientes

- Mantenha README com instru√ß√µes de como alternar entre Sandbox/Production
- Facilita onboarding de novos desenvolvedores

<Warning>
  **üîí Seguran√ßa Cr√≠tica:**
  - Tokens de Produ√ß√£o t√™m mesmo n√≠vel de acesso que credenciais de banco
  - Proteja-os adequadamente (n√£o commitar em reposit√≥rios)
  - Dados reais enviados com token Sandbox ser√£o deletados ap√≥s 30 dias
</Warning>

## Troubleshooting de Ambientes

<AccordionGroup>

<Accordion title="‚ùå Enviei dados no Sandbox mas n√£o aparecem">
  **Poss√≠veis Causas:**
  - Dados foram enviados h√° mais de 30 dias (deletados automaticamente)
  - Token JWT tem claim `environment` incorreto
  - Consultando com token diferente do usado para envio

  **Solu√ß√µes:**
  1. Verifique claim `environment` do token em [jwt.io](https://jwt.io)
  2. Confirme que token usado para enviar = token usado para consultar
  3. Se dados > 30 dias, reenvie dados de teste
  4. Consulte [Audit Log API](/integration/api-ingestion/audit-log) para ver hist√≥rico de envios

  **Exemplo de Valida√ß√£o:**
  ```json
  {
    "tenant_id": "cli_abc123",
    "environment": "sandbox",  // ‚Üê Deve ser "sandbox" para dados de teste
    "scopes": ["ingestion:write"],
    "exp": 1707321600
  }
  ```
</Accordion>

<Accordion title="‚ùå Dados do Sandbox aparecem em Produ√ß√£o (ou vice-versa)">
  **Causa:** Isso N√ÉO deveria acontecer - isolamento √© absoluto.

  **Valida√ß√£o Imediata:**
  1. Confirme claim `environment` do token atual em [jwt.io](https://jwt.io)
  2. Verifique URL usada:
     - Sandbox: `ingestion.nexfar.com.br`
     - Production: `ingestion.nexfar.com.br`
  3. Se problema persistir, **reporte IMEDIATAMENTE**: suporte@nexfar.com.br

  <Warning>
    **üîí Seguran√ßa Cr√≠tica:** Viola√ß√£o de isolamento de ambientes √© bug cr√≠tico. Reporte imediatamente.
  </Warning>
</Accordion>

<Accordion title="‚úÖ Como validar que estou no ambiente correto?">
  **Passo a Passo:**

  1. **Decodificar JWT token** em [https://jwt.io](https://jwt.io)
  2. **Verificar claim `environment`:**
     - `"sandbox"` ‚Üí Voc√™ est√° no Sandbox
     - `"production"` ‚Üí Voc√™ est√° em Produ√ß√£o
  3. **Confirmar URL corresponde ao environment:**
     - Sandbox: `https://ingestion.nexfar.com.br`
     - Production: `https://ingestion.nexfar.com.br`
  4. **Enviar requisi√ß√£o de teste e verificar Audit Log**

  **Exemplo de Verifica√ß√£o (Python):**
  ```python
  import jwt
  import os

  token = os.getenv("NEXFAR_JWT")
  decoded = jwt.decode(token, options={"verify_signature": False})

  print(f"Environment: {decoded['environment']}")
  # Output esperado: "sandbox" ou "production"

  if decoded['environment'] == 'sandbox':
      print("‚úÖ Usando ambiente Sandbox (dados s√£o tempor√°rios)")
  else:
      print("‚úÖ Usando ambiente Production (dados s√£o persistentes)")
  ```
</Accordion>

<Accordion title="‚ùå Token de Produ√ß√£o n√£o funciona">
  **Poss√≠veis Causas:**
  - Token expirado (verificar claim `exp` em jwt.io)
  - Token copiado incorretamente (espa√ßos extras, quebras de linha)
  - Usando URL de Sandbox com token de Produ√ß√£o

  **Solu√ß√µes:**
  1. **Validar expira√ß√£o do token:**
     - Decodifique em jwt.io
     - Verifique claim `exp` (timestamp Unix)
     - Compare com timestamp atual: se `exp < now`, token expirado
  2. **Recopiar token do email:**
     - Copie token completo, sem espa√ßos ou quebras
     - Formato: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` (string longa)
  3. **Confirmar URL correta:**
     - Production usa `ingestion.nexfar.com.br` (SEM "sandbox" na URL)
  4. **Testar com curl antes de integrar ao c√≥digo:**
     ```bash
     curl -X POST https://ingestion.nexfar.com.br/api/v1/clients \
       -H "Authorization: Bearer $NEXFAR_JWT_PRODUCTION" \
       -H "Content-Type: application/json" \
       -d '{"cnpj": "12.345.678/0001-90", "razao_social": "Teste LTDA"}'
     ```
  5. Se problema persistir, contate suporte@nexfar.com.br
</Accordion>

</AccordionGroup>

## Pr√≥ximos Passos

<CardGroup cols={2}>

<Card title="Come√ßar no Sandbox" icon="flask" href="/integration/api-ingestion/quickstart">
  Use Quick Start para enviar primeira requisi√ß√£o no ambiente de testes
</Card>

<Card title="Entender Autentica√ß√£o" icon="key" href="/integration/api-ingestion/authentication">
  Aprenda sobre JWT tokens e claims, incluindo o claim `environment`
</Card>

<Card title="Validar Dados" icon="list-check" href="/integration/api-ingestion/audit-log">
  Use Audit Log API para consultar hist√≥rico de envios e validar environment
</Card>

<Card title="Solicitar Produ√ß√£o" icon="rocket">
  Ap√≥s valida√ß√£o completa, envie email para **suporte@nexfar.com.br**
</Card>

</CardGroup>

<Tip>
  **üí° Recomenda√ß√£o:** Sempre comece no Sandbox e s√≥ solicite credenciais de Produ√ß√£o ap√≥s valida√ß√£o completa. Use Audit Log API para confirmar que dados est√£o no ambiente correto.
</Tip>
