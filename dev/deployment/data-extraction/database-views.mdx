---
title: "Acesso via Banco de Dados"
description: "Integra√ß√£o com a Nexfar atrav√©s de VIEWs padronizadas no banco de dados"
---

## Vis√£o Geral

O acesso via banco de dados permite que a Nexfar extraia dados do seu ERP atrav√©s de VIEWs SQL padronizadas. Este √© um dos m√©todos mais perform√°ticos e diretos de integra√ß√£o.

## Requisitos T√©cnicos

### M√©todo 1: Conex√£o via VPN (Recomendado) ‚≠ê

A Nexfar utiliza **Tailscale** (VPN site-to-site) para criar conex√µes seguras com bancos de dados dos clientes.

**Vantagens:**
- ‚úÖ **Seguran√ßa aprimorada**: Criptografia end-to-end autom√°tica
- ‚úÖ **Instala√ß√£o simples**: Comando de uma linha (one-line install)
- ‚úÖ **Flexibilidade**: Funciona de qualquer localiza√ß√£o, sem necessidade de IP fixo
- ‚úÖ **Gerenciamento f√°cil**: Controle de acesso centralizado via ACLs
- ‚úÖ **Sem exposi√ß√£o p√∫blica**: Banco de dados n√£o fica exposto na internet

**Instala√ß√£o R√°pida:**

<CodeGroup>
```bash Linux/Unix
curl -fsSL https://raw.githubusercontent.com/nexfar/vpn/main/install.sh | sudo bash
```

```bash Linux/Unix (wget)
wget -qO- https://raw.githubusercontent.com/nexfar/vpn/main/install.sh | sudo bash
```

```powershell Windows (PowerShell)
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/nexfar/vpn/main/install.ps1" -OutFile "$env:TEMP\install.ps1"
& "$env:TEMP\install.ps1"
```
</CodeGroup>

**Informa√ß√µes Necess√°rias:**
- **Auth Key**: Fornecido pela equipe Nexfar
- **Porta do banco de dados**: Ex: 5432 (PostgreSQL), 3306 (MySQL), 1521 (Oracle)
- **Tipo do banco**: postgres, mysql, oracle, sqlserver, mongodb, etc.

<Tip>
  **Documenta√ß√£o completa da VPN:** [github.com/nexfar/vpn](https://github.com/nexfar/vpn)
</Tip>

---

### M√©todo 2: Libera√ß√£o de IPs (Alternativo)

Se sua organiza√ß√£o preferir conex√£o direta sem VPN, libere os seguintes IPs no firewall:

<Warning>
  **IPs que devem ser liberados no firewall:**
  - `189.28.42.170`
  - `170.84.19.69`

  ‚ö†Ô∏è **Nota:** Este m√©todo requer IP fixo e exp√µe o banco de dados publicamente. Recomendamos usar VPN para maior seguran√ßa.
</Warning>

### Nomenclatura das VIEWs

As views, tabelas ou endpoints devem sempre sinalizar que s√£o destinadas √† integra√ß√£o da Nexfar:

- **VIEW**: Deve se chamar `VIEW_NEXFAR_CLIENT`, `VIEW_NEXFAR_PRODUCT`, etc.
- **Tabela**: Deve se chamar `NEXFAR_CLIENT`, `NEXFAR_PRODUCT`, etc.
- **Endpoint**: Deve se chamar `NEXFAR_CLIENT`, `NEXFAR_PRODUCT`, etc.

## Op√ß√µes de Implementa√ß√£o

### Op√ß√£o 1: VIEWs Diretas

Cria√ß√£o de VIEWs que acessam diretamente as tabelas do ERP.

<Info>
  Esta √© a op√ß√£o mais simples e recomendada quando n√£o h√° restri√ß√µes de acesso direto ao banco de produ√ß√£o.
</Info>

### Op√ß√£o 2: Banco Intermedi√°rio

Caso o cliente opte por disponibilizar um banco intermedi√°rio, as tabelas deste banco devem:

- **Ser incrementais**: Os dados devem ser sempre acrescentados, nunca removidos e inseridos novamente
- **Possuir coluna de auditoria**: Incluir uma coluna que informe a data em que o registro foi inserido ou atualizado

<Note>
  **Views Materializadas**: Caso n√£o seja poss√≠vel realizar uma implementa√ß√£o incremental dos dados, √© fundamental a cria√ß√£o de views materializadas. Recomendamos o uso do PostgreSQL para este cen√°rio.
</Note>

#### Fluxo com Views Materializadas

```sql
-- 1. Apagar os registros da tabela
TRUNCATE TABLE nexfar_client;

-- 2. Repopular a tabela
INSERT INTO nexfar_client SELECT * FROM erp_clients WHERE active = true;

-- 3. Dar refresh na view materializada
REFRESH MATERIALIZED VIEW view_nexfar_client;
```

### Op√ß√£o 3: API REST

Caso o cliente opte por disponibilizar uma API, os endpoints disponibilizados devem permitir o uso de `queryFilters` para todos os campos:

- **VARCHAR**: Opera√ß√µes LIKE
- **DATE/TIMESTAMP**: Intervalos
- **INTEGER**: Operadores `>` e `<`
- **Pagina√ß√£o**: Filtros padr√£o `page` e `pageSize`

## Legendas e Sinaliza√ß√µes

Ao analisar a documenta√ß√£o das VIEWs, voc√™ encontrar√° os seguintes s√≠mbolos:

- **#Ô∏è‚É£** Campos que formam o `hashErp` - a combina√ß√£o deles deve ser √∫nica por registro
- **üîç** Campos frequentemente utilizados para busca - devem ser indexados
- **‚ö†Ô∏è** Campos que n√£o devem ser enviados por padr√£o - tratados via regra do integrador

<Note>
  Nas tabelas de refer√™ncia, as colunas em **verde** sinalizam informa√ß√µes que podem ser compartilhadas com o cliente, enquanto as em **cinza** apresentam informa√ß√µes exclusivamente internas.
</Note>

## VIEWs Dispon√≠veis

As VIEWs est√£o organizadas por categoria para facilitar a implementa√ß√£o:

<CardGroup cols={2}>
  <Card title="Cadastros B√°sicos" icon="users" href="/deployment/data-extraction/views/cadastros-basicos">
    Clientes, Condi√ß√µes de Pagamento, Vendedores e Grupos de Pre√ßo
  </Card>

  <Card title="Produtos" icon="box" href="/deployment/data-extraction/views/produtos">
    Produtos, Filiais, Armaz√©ns, Pre√ßos e Restri√ß√µes
  </Card>

  <Card title="Pedidos" icon="file-invoice" href="/deployment/data-extraction/views/pedidos">
    Cabe√ßalho e Itens de Pedidos (normais e distribuidores)
  </Card>

  <Card title="Vendas" icon="chart-line" href="/deployment/data-extraction/views/vendas">
    Cabe√ßalho, Itens, Clientes e Vendedores de Vendas
  </Card>

  <Card title="Combos" icon="layer-group" href="/deployment/data-extraction/views/combos">
    Cabe√ßalho, Itens, Clientes e Vendedores de Combos
  </Card>

  <Card title="Impostos e Margens" icon="percent" href="/deployment/data-extraction/views/impostos-margens">
    Determina√ß√µes e Valores de Impostos e Margens
  </Card>

  <Card title="Documentos Fiscais" icon="file-lines" href="/deployment/data-extraction/views/documentos-fiscais">
    Notas Fiscais e Documentos Relacionados
  </Card>
</CardGroup>

## Pr√≥ximos Passos

1. **Escolha o m√©todo de conex√£o**:
   - **VPN (Recomendado)**: Instale o cliente Tailscale usando os comandos acima
   - **Libera√ß√£o de IPs**: Configure firewall para permitir acesso dos IPs da Nexfar

2. Escolha a op√ß√£o de implementa√ß√£o mais adequada (VIEW direta, banco intermedi√°rio ou API)

3. Revise as VIEWs necess√°rias para sua integra√ß√£o

4. Implemente as VIEWs seguindo as especifica√ß√µes de cada categoria

5. **Configure o acesso**:
   - Se usar VPN: Forne√ßa as informa√ß√µes de conex√£o (porta, tipo de banco)
   - Se usar IPs: Confirme libera√ß√£o no firewall

6. Entre em contato para valida√ß√£o da integra√ß√£o

<Tip>
  Recomendamos come√ßar pelas VIEWs de **Cadastros B√°sicos** (Cliente e Condi√ß√µes de Pagamento) e depois expandir para as demais categorias.
</Tip>
